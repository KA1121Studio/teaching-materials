<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>YouTube DASH再生デモ</title>
</head>
<body style="background:#111;color:#fff">

<h2>DASH動画同期再生デモ</h2>

<video id="v" controls autoplay playsinline style="width:100%"></video>
<audio id="a" preload="auto" style="display:none;"></audio>

<script>
async function load() {
  const videoEl = document.getElementById("v");
  const audioEl = document.getElementById("a");

  // サーバーから動画と音声のURLを取得
  const res = await fetch("/video?id=VtGSvx866Js");
  const data = await res.json();

  // URLをセット
  videoEl.src = data.video; // itag=動画トラック
  audioEl.src = data.audio; // itag=音声トラック

  // 同期再生
  await videoEl.play();
  await audioEl.play();

  // 簡易同期（動画に追従）
  videoEl.ontimeupdate = () => {
    if (Math.abs(videoEl.currentTime - audioEl.currentTime) > 0.1) {
      audioEl.currentTime = videoEl.currentTime;
    }
  };

  // 一時停止/再生も同期
  videoEl.onpause = () => audioEl.pause();
  videoEl.onplay = () => audioEl.play();
}

load();
</script>

</body>
</html>
